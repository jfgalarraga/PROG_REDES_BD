<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador con Prueba de Escritorio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/diagramas.css">
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Consola -->
            <div class="col-12 col-md-4 sticky-top">
                <div class="row">
                    <div class="col-12" id="seccionVelocidad" style="display: block;">

                        <div class="d-flex flex-column gap-3" style="padding-top: 5%;">
                            <div>
                                <p><strong>Selecciona la velocidad:</strong></p>
                                <div class="d-flex flex-wrap gap-2">
                                    <button id="speed0_5" class="botones-velocidad flex-fill">x0.5</button>
                                    <button id="speed1" class="botones-velocidad flex-fill">x1</button>
                                    <button id="speed2" class="botones-velocidad flex-fill">x2</button>
                                    <button id="speed5" class="botones-velocidad flex-fill">x5</button>
                                    <button id="speed10" class="botones-velocidad flex-fill">x10</button>
                                </div>
                            </div>

                            <div class="d-flex gap-2 justify-content-between align-items-center flex-wrap">
                                <input id="customSpeed" type="number" step="0.1" placeholder="Velocidad personalizada"
                                    class="form-control flex-grow-1" style="max-width: 70%;">
                                <button id="setCustomSpeed" class="botones-velocidad"
                                    style="max-width: 25%;">Usar</button>
                            </div>

                            <p class="text-muted"><span>&#128161;</span> Consejo: comienza con una velocidad baja y
                                cuando comprendas el algoritmo, prueba una velocidad mayor</p>


                        </div>

                    </div>
                    <div class="col-12" id="seccionConsola" style="display: none;">
                        <p><strong> ¡Interactua con la consola!</strong></p>
                        <div id="console">
                            <input type="text" id="inputField" disabled class="form-control">
                        </div>
                        <button id="startButton" class="botonStart flex-fill" style="display: block; width: 100%;">Empezar</button>
                        <button id="restartButton" class="botonStart flex-fill" style="display: none; width: 100%;">Reiniciar</button>

                    </div>



                    <div class="col-12" id="seccionPruebaEscritorio" style="display: none; padding-top: 5%;">
                        <p><strong> Prueba de escritorio</strong></p>
                        <p class="text-muted"><span>&#128161;</span> Observa cómo cambia el valor de las variables</p>
                        <div class="table-container" style="max-height: 400px; overflow-y:auto;">
                            <table class="table table-bordered table-striped" id="pruebaEscritorioTabla">
                                <thead class="sticky-top">
                                    <tr>
                                        <th>Paso</th>
                                        <th>n</th>
                                        <th>i</th>
                                        <th>Factorial</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Filas dinámicas -->
                                </tbody>
                            </table>
                        </div>
                        
                        
                    </div>

                </div>


            </div>
            <div class="col-12 col-md-8" id="seccionDiagrama">
                <svg xmlns="http://www.w3.org/2000/velocidad/svg" viewBox="0 0 1000 1000" width="100%" height="100%">
                    <!-- Elipse para "Inicio" -->
                    <ellipse cx="500" cy="50" rx="75" ry="25" class="elipse" id="fa_elipseInicio" />
                    <text x="500" y="50" class="texto-mediano" id="texto_fa_elipseInicio">
                        Inicio
                    </text>
                    <line x1="500" y1="75" x2="500" y2="100" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />

                    <!-- Paralelogramo para "Ingresa un número" -->
                    <polygon points="400,100 650,100 600,150 350,150" class="poligono" id="fa_paralelogramo1" />
                    <text x="500" y="125" class="texto-mediano" id="texto_fa_paralelogramo1">
                        <tspan font-style="italic">Ingresa un número</tspan>

                    </text>
                    <line x1="500" y1="150" x2="500" y2="175" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />
                    <line x1="625" y1="110" x2="700" y2="75" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_salida)" />

                    <!-- Paralelogramo "numero" -->
                    <polygon points="400,175 650,175 600,225 350,225" class="poligono" id="fa_paralelogramo2" />
                    <text x="500" y="200" class="texto-mediano" id="texto_fa_paralelogramo2">
                        Leer numero (n)
                    </text>
                    <line x1="625" y1="185" x2="700" y2="150" stroke="black" stroke-width="2"
                        marker-start="url(#flecha_entrada)" />
                    <line x1="500" y1="225" x2="500" y2="250" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />




                    <!--Rombo numero > 0-->
                    <polygon points="500,250 600,300 500,350 400,300" class="rombo" id="fa_rombo1" />
                    <text x="500" y="300" class="texto-mediano" id="texto_fa_rombo1">
                        n < 0 </text>
                    <line x1="400" y1="300" x2="250" y2="300" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />
                    <text x="325" y="290" class="texto-pequeño" id="falso1">
                        Falso
                    </text>
                    <line x1="600" y1="300" x2="700" y2="300" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />
                    <text x="650" y="290" class="texto-pequeño" id="verdadero1">
                        Verdadero
                    </text>


                    <!-- paralelogramo factorial no existe-->
                    <polygon points="725,275 925,275 875,325 675,325" class="poligono" id="fa_paralelogramo3" />
                    <text x="800" y="300" class="texto-mediano" id="texto_fa_paralelogramo3">
                        <tspan font-style="italic">Factorial no existe</tspan>
                    </text>
                    <line x1="900" y1="285" x2="975" y2="250" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_salida)" />
                    <line x1="850" y1="325" x2="850"  y2="925" stroke="black" stroke-width="2" />
                    <line x1="850" y1="925" x2="575" y2="925" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />


                    <!-- rectangulo i = 1-->
                    <rect x="100" y="275" width="150" height="50" class="rectangulo" id="fa_rectangulo1" />
                    <text x="175" y="300" class="texto-mediano" id="texto_fa_rectangulo1">
                        i ← 1
                    </text>
                    <line x1="175" y1="325" x2="175" y2="350" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />

                    <!--rectangulo factorial = 1-->
                    <rect x="100" y="350" width="150" height="50" class="rectangulo" id="fa_rectangulo2" />
                    <text x="175" y="375" class="texto-mediano" id="texto_fa_rectangulo2">
                        factorial ← 1
                    </text>
                    <line x1="175" y1="400" x2="175" y2="475" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />

                    <!--rombo 2-->
                    <polygon points="175,475 250,525 175,575 100,525" class="rombo" id="fa_rombo2" />
                    <text x="175" y="525" class="texto-mediano" id="texto_fa_rombo2">
                        i ≤ n
                    </text>

                    <!--verdadero-->
                    <line x1="175" y1="575" x2="175" y2="625" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />
                    <text x="225" y="600" class="texto-pequeño" id="verdadero2">
                        Verdadero
                    </text>

                    <!--falso-->
                    <line x1="250" y1="525" x2="500" y2="525" stroke="black" stroke-width="2" />
                    <text x="375" y="515" class="texto-pequeño" id="falso2">
                        Falso
                    </text>
                    <line x1="500" y1="525" x2="500" y2="800" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />


                    <!--paralelogramo factorial = factorial * i-->
                    <rect x="75" y="625" width="200" height="50" class="rectangulo" id="fa_rectangulo3" />
                    <text x="175" y="650" class="texto-mediano" id="texto_fa_rectangulo3">
                        factorial ← factorial * i
                    </text>
                    <line x1="175" y1="675" x2="175" y2="700" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />

                    <!--paralelogramo i = i++-->
                    <rect x="100" y="700" width="150" height="50" class="rectangulo" id="fa_rectangulo4" />
                    <text x="175" y="725" class="texto-mediano" id="texto_fa_rectangulo4">
                        i ← i + 1
                    </text>
                    <line x1="175" y1="750" x2="175" y2="800" stroke="black" stroke-width="2" />
                    <line x1="175" y1="800" x2="20" y2="800" stroke="black" stroke-width="2" />
                    <line x1="20" y1="800" x2="20" y2="450" stroke="black" stroke-width="2" />
                    <line x1="20" y1="450" x2="175" y2="450" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />

                    <!--paralelogramo imprimir numero-->
                    <polygon points="350,800 700,800 650,850 300,850" class="poligono" id="fa_paralelogramo4" />
                    <text x="500" y="825" class="texto-mediano" id="texto_fa_paralelogramo4">
                        <tspan font-style="italic">El factorial del numero es:</tspan>
                        factorial
                    </text>
                    <line x1="675" y1="810" x2="750" y2="775" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_salida)" />
                    <line x1="500" y1="850" x2="500" y2="900" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />

                    <!-- Elipse para final -->
                    <ellipse cx="500" cy="925" rx="75" ry="25" class="elipse" id="fa_elipseFinal" />
                    <text x="500" y="925" class="texto-mediano" id="texto_fa_elipseFinal">
                        Final
                    </text>
                    <line x1="500" y1="75" x2="500" y2="100" stroke="black" stroke-width="2"
                        marker-end="url(#flecha_normal)" />

                    <!--Flechas-->
                    <defs>
                        <marker id="flecha_normal" viewBox="0 0 20 20" refX="10" refY="10" orient="auto">
                            <path d="M0,0 L20,10 L0,20 z" fill="black" />
                        </marker>
                    </defs>

                    <defs>
                        <marker id="flecha_salida" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                            <path d="M0,0 L10,5 L0,10 Z" fill="black" />
                        </marker>
                    </defs>

                    <defs>
                        <marker id="flecha_entrada" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                            <path d="M10,0 L0,5 L10,10 Z" fill="black" />
                        </marker>
                    </defs>
                </svg>
            </div>


        </div>


    </div>
    <script>
        const consoleDiv = document.getElementById('console');
        const inputField = document.getElementById('inputField');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const tableBody = document.getElementById('pruebaEscritorioTabla').querySelector('tbody');
        const seccionConsola = document.getElementById('seccionConsola');
        const seccionVelocidad = document.getElementById('seccionVelocidad');
        const seccionPruebaEscritorio = document.getElementById('seccionPruebaEscritorio')
        const tableContainer = document.querySelector('.table-container');

        let velocidad = 1;
        let n = null;
        let isStarted = false;

        let currentStep = 0;

        const customSpeedInput = document.getElementById("customSpeed");
        const setCustomSpeedButton = document.getElementById("setCustomSpeed");

       
        // Asignar eventos a cada botón de velocidad
        document.getElementById('speed0_5').addEventListener("click", () => {
            velocidad = 0.5;
            seccionVelocidad.style.display = "none";
            seccionConsola.style.display = "block";
            seccionPruebaEscritorio.style.display = "block";
        });

        document.getElementById('speed1').addEventListener("click", () => {
            velocidad = 1;
            seccionVelocidad.style.display = "none";
            seccionConsola.style.display = "block";
            seccionPruebaEscritorio.style.display = "block";
        });

        document.getElementById('speed2').addEventListener("click", () => {
            velocidad = 2;
            seccionVelocidad.style.display = "none";
            seccionConsola.style.display = "block";
            seccionPruebaEscritorio.style.display = "block";
        });

        document.getElementById('speed5').addEventListener("click", () => {
            velocidad = 5;
            seccionVelocidad.style.display = "none";
            seccionConsola.style.display = "block";
            seccionPruebaEscritorio.style.display = "block";
        });

        document.getElementById('speed10').addEventListener("click", () => {
            velocidad = 10;
            seccionVelocidad.style.display = "none";
            seccionConsola.style.display = "block";
            seccionPruebaEscritorio.style.display = "block";
        });

        
        // Asignar evento al botón para usar velocidad personalizada
        setCustomSpeedButton.addEventListener("click", () => {
            const customSpeed = parseFloat(customSpeedInput.value);
            if (!isNaN(customSpeed) && customSpeed > 0) {
                velocidad = customSpeed;
                seccionVelocidad.style.display = "none";
            seccionConsola.style.display = "block";
            seccionPruebaEscritorio.style.display = "block";

            } else {
                alert("Por favor, introduce un valor válido para la velocidad.");
            }
        });



        // Función para escribir en la consola
        function writeToConsole(message) {
            const line = document.createElement('div');
            line.textContent = message;
            consoleDiv.insertBefore(line, inputField);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        // Función para agregar una fila en la prueba de escritorio
        function addRowToTable(step, n, i, factorial) {
            const row = document.createElement('tr');
            row.innerHTML = `
        <td>${step}</td>
        <td>${n}</td>
        <td>${i}</td>
        <td>${factorial}</td>
    `;
            tableBody.appendChild(row);

            // Ajustar el scroll al final del contenedor
            tableContainer.scrollTop = tableContainer.scrollHeight;
        }




        // Función principal con ejecución lenta
        async function calculateFactorial(n) {

            inputField.disabled = true;

            resaltarConTiempos('fa_paralelogramo1', [
                { tiempo: 0, agregar: false, clase: 'resaltar' },    // Añadir la clase al iniciar

            ]);

            document.getElementById('texto_fa_paralelogramo1').classList.remove('texto-mediano-resaltado');



            setTimeout(() => {
                writeToConsole(`>> El número ingresado es ${n}`);
            }, 3000 / velocidad);

            resaltarConTiempos('fa_paralelogramo2', [
                { tiempo: 0, agregar: true, clase: 'resaltar' },
                { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' },

            ]);

            resaltarConTiempos('texto_fa_paralelogramo2', [
                { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },

            ]);


            setTimeout(() => {

                resaltarConTiempos('fa_rombo1', [
                    { tiempo: 0, agregar: true, clase: 'resaltar' },
                    { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' },
                ]);
                resaltarConTiempos('texto_fa_rombo1', [
                    { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                    { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                ]);

            }, 3000 / velocidad);

            if (n < 0) {


                setTimeout(() => {

                    resaltarConTiempos('verdadero1', [
                        { tiempo: 0, agregar: true, clase: 'texto-pequeño-resaltado' },
                        { tiempo: 2000 / velocidad, agregar: false, clase: 'texto-pequeño-resaltado' },
                    ]);
                }, 6000 / velocidad);

                setTimeout(() => {
                    resaltarConTiempos('fa_paralelogramo3', [
                        { tiempo: 0, agregar: true, clase: 'resaltar' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' },
                    ]);
                    resaltarConTiempos('texto_fa_paralelogramo3', [
                        { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                    ]);
                }, 8000 / velocidad);

                setTimeout(() => {
                    writeToConsole(">> El factorial de negativos no existe");
                }, 8000 / velocidad);

                setTimeout(() => {
                    resaltarConTiempos('fa_elipseFinal', [
                        { tiempo: 0, agregar: true, clase: 'resaltar' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' },
                    ]);
                    resaltarConTiempos('texto_fa_elipseFinal', [
                        { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                    ]);
                }, 11000 / velocidad);

                setTimeout(() => {
                    writeToConsole(">> Fin del programa")
                }, 11000 / velocidad);

                inputField.disabled = true;

            } else {
                let i = 1;
                let factorial = 1;

                setTimeout(() => {
                    resaltarConTiempos('falso1', [
                        { tiempo: 0, agregar: true, clase: 'texto-pequeño-resaltado' },
                        { tiempo: 2000 / velocidad, agregar: false, clase: 'texto-pequeño-resaltado' },
                    ]);
                    writeToConsole('>> Calculando... ¡Revisa la prueba de escritorio!');
                    addRowToTable(++currentStep, n, null, null);

                }, 6000 / velocidad);


                setTimeout(() => {
                    resaltarConTiempos('fa_rectangulo1', [
                        { tiempo: 0, agregar: true, clase: 'resaltar' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' },
                    ]);
                    resaltarConTiempos('texto_fa_rectangulo1', [
                        { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                    ]);

                    addRowToTable(++currentStep, n, 1, null);


                }, 8000 / velocidad);



                setTimeout(() => {
                    resaltarConTiempos('fa_rectangulo2', [
                        { tiempo: 0, agregar: true, clase: 'resaltar' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' },
                    ]);
                    resaltarConTiempos('texto_fa_rectangulo2', [
                        { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                    ]);

                    addRowToTable(++currentStep, n, 1, 1);
                }, 11000 / velocidad);


                function procesarIteracion() {
                    resaltarConTiempos('fa_rombo2', [
                        { tiempo: 0, agregar: true, clase: 'resaltar' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' },
                    ]);

                    resaltarConTiempos('fa_rombo2', [
                        { tiempo: 0, agregar: true, clase: 'resaltar' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' },
                    ]);

                    if (i > n) return; // Detener cuando se alcance el límite


                    resaltarConTiempos('texto_fa_rombo2', [
                        { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                    ]);
                    resaltarConTiempos('verdadero2', [
                        { tiempo: 0, agregar: false, clase: 'texto-pequeño-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: true, clase: 'texto-pequeño-resaltado' },
                        { tiempo: 5000 / velocidad, agregar: false, clase: 'texto-pequeño-resaltado' },
                    ]);

                    resaltarConTiempos('fa_rectangulo3', [
                        { tiempo: 0, agregar: false, clase: 'resaltar' },
                        { tiempo: 5000 / velocidad, agregar: true, clase: 'resaltar' },
                        { tiempo: 8000 / velocidad, agregar: false, clase: 'resaltar' },
                    ]);
                    resaltarConTiempos('texto_fa_rectangulo3', [
                        { tiempo: 0, agregar: false, clase: 'texto-mediano-resaltado' },
                        { tiempo: 5000 / velocidad, agregar: true, clase: 'texto-mediano-resaltado' },
                        { tiempo: 8000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                    ]);

                    resaltarConTiempos('fa_rectangulo4', [
                        { tiempo: 0, agregar: false, clase: 'resaltar' },
                        { tiempo: 8000 / velocidad, agregar: true, clase: 'resaltar' },
                        { tiempo: 11000 / velocidad, agregar: false, clase: 'resaltar' },
                    ]);
                    resaltarConTiempos('texto_fa_rectangulo4', [
                        { tiempo: 0, agregar: false, clase: 'texto-mediano-resaltado' },
                        { tiempo: 8000 / velocidad, agregar: true, clase: 'texto-mediano-resaltado' },
                        { tiempo: 11000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                    ]);

                    // Ejecución a los 5000/velocidadms
                    setTimeout(() => {
                        factorial = factorial * i;
                        addRowToTable(++currentStep, n, i, factorial);
                    }, 5000 / velocidad);

                    // Ejecución a los 8000ms
                    setTimeout(() => {
                        i++;
                        addRowToTable(++currentStep, n, i, factorial);
                    }, 8000 / velocidad);

                    // Llamar a la siguiente iteración después de 11 segundos
                    setTimeout(procesarIteracion, 11000 / velocidad);
                }

                setTimeout(() => {
                    procesarIteracion();
                }, 14000 / velocidad);



                let tiempo = 14000 / velocidad + (11000 / velocidad * n);


                setTimeout(() => {
                    resaltarConTiempos('texto_fa_rombo2', [
                        { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                    ]);
                }, tiempo);



                setTimeout(() => {
                    resaltarConTiempos('falso2', [
                        { tiempo: 0, agregar: true, clase: 'texto-pequeño-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-pequeño-resaltado' },
                    ]);
                }, tiempo + 3000 / velocidad);

                setTimeout(() => {
                    resaltarConTiempos('fa_paralelogramo4', [
                        { tiempo: 0, agregar: true, clase: 'resaltar' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' },
                    ]);

                    resaltarConTiempos('texto_fa_paralelogramo4', [
                        { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                    ]);
                    writeToConsole(`>> El factorial de ${n} es: ${factorial}`);
                }, tiempo + 6000 / velocidad);

                setTimeout(() => {
                    resaltarConTiempos('fa_elipseFinal', [
                        { tiempo: 0, agregar: true, clase: 'resaltar' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' },
                    ]);

                    resaltarConTiempos('texto_fa_elipseFinal', [
                        { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' },
                    ]);
                    writeToConsole(">> Fin del programa");
                }, tiempo + 9000 / velocidad);






                inputField.disabled = true;




            }
        }

        startButton.addEventListener('click', () => {
            if (!isStarted) {
                // Mostrar el mensaje inicial
                writeToConsole(">> Iniciando programa...");
                // Figura
                resaltarConTiempos('fa_elipseInicio', [
                    { tiempo: 0, agregar: true, clase: 'resaltar' },
                    { tiempo: 3000 / velocidad, agregar: false, clase: 'resaltar' }
                ]);
                resaltarConTiempos('texto_fa_elipseInicio', [
                    { tiempo: 0, agregar: true, clase: 'texto-mediano-resaltado' },
                    { tiempo: 3000 / velocidad, agregar: false, clase: 'texto-mediano-resaltado' }
                ]);

                if (n === null || isNaN(n)) {
                    resaltarConTiempos('fa_paralelogramo1', [
                        { tiempo: 0, agregar: false, clase: 'resaltar' },
                        { tiempo: 3000 / velocidad, agregar: true, clase: 'resaltar' }
                    ]);
                    resaltarConTiempos('texto_fa_paralelogramo1', [
                        { tiempo: 0, agregar: false, clase: 'texto-mediano-resaltado' },
                        { tiempo: 3000 / velocidad, agregar: true, clase: 'texto-mediano-resaltado' }
                    ]);



                }

                isStarted = true;
                startButton.disabled = true;

                // Esperar 3 segundos antes de mostrar el siguiente mensaje y habilitar el input
                setTimeout(() => {
                    writeToConsole(">> Ingresa un número:");
                    inputField.disabled = false;
                    inputField.focus();
                    startButton.style.display = "none";
                    restartButton.style.display = "block";
                }, 3000 / velocidad); // Retraso de 3 segundos
            }
        });

        // Evento para capturar la entrada del usuario
        inputField.addEventListener('keydown', function (event) {



            if (event.key === 'Enter') {
                const input = inputField.value.trim();
                inputField.value = '';

                if (input === '') {
                    writeToConsole(">> Por favor, ingrese un número.");
                    return;
                }

                n = parseInt(input, 10);


                if (isNaN(n)) {
                    writeToConsole(">> Entrada no válida. Por favor, ingrese un número entero.");
                } else {
                    calculateFactorial(n);

                }
            }
        });






        // Evento para reiniciar el simulador
        restartButton.addEventListener('click', () => {
            // Limpiar consola
            location.reload();
        });
        


        function resaltarConTiempos(elementId, tiempos) {
            const element = document.getElementById(elementId);
            if (!element) {
                console.error(`Elemento con ID "${elementId}" no encontrado.`);
                return;
            }

            // Guardar las clases originales
            const clasesOriginales = element.getAttribute("class") || "";

            // Guardar dimensiones originales una vez
            obtenerDimensiones(element);

            let enProceso = false; // Bloqueo para evitar solapamientos

            tiempos.forEach((evento) => {
                setTimeout(() => {
                    if (enProceso) return; // Ignorar si ya hay una transformación en proceso
                    enProceso = true;

                    if (evento.agregar) {
                        if (element.tagName === "text") {
                            // Para elementos <text>, agregar la clase sin sobrescribir las originales
                            element.setAttribute("class", `${clasesOriginales} ${evento.clase}`.trim());
                        } else {
                            element.classList.add(evento.clase);
                        }
                        aplicarZoom(element, true); // Zoom in
                    } else {
                        if (element.tagName === "text") {
                            // Restaurar las clases originales
                            element.setAttribute("class", clasesOriginales);
                        } else {
                            element.classList.remove(evento.clase);
                        }
                        aplicarZoom(element, false); // Restaurar tamaño original
                    }

                    enProceso = false; // Liberar bloqueo
                }, evento.tiempo);
            });
        }



        // Almacenamiento global para las dimensiones originales de cada figura
        const dimensionesOriginalesGlobal = {};

        // Actualización de `obtenerDimensiones` para soportar nuevos atributos
        function obtenerDimensiones(element) {
            const id = element.id;

            // Si ya existen dimensiones originales para este elemento, no recalcular
            if (dimensionesOriginalesGlobal[id]) {
                return dimensionesOriginalesGlobal[id];
            }

            const tagName = element.tagName.toLowerCase();
            let dimensiones = null;

            switch (tagName) {
                case 'ellipse':
                    dimensiones = {
                        rx: parseFloat(element.getAttribute('rx')),
                        ry: parseFloat(element.getAttribute('ry')),
                    };
                    break;
                case 'rect':
                    dimensiones = {
                        x: parseFloat(element.getAttribute('x')),
                        y: parseFloat(element.getAttribute('y')),
                        width: parseFloat(element.getAttribute('width')),
                        height: parseFloat(element.getAttribute('height')),
                    };
                    break;
                case 'polygon':
                    dimensiones = {
                        points: element.getAttribute('points'),
                    };
                    break;
                default:
                    console.warn(`Tipo de elemento "${tagName}" no soportado.`);
            }

            if (dimensiones) {
                // Guardar dimensiones originales de forma inmutable
                dimensionesOriginalesGlobal[id] = { ...dimensiones };
            }

            return dimensiones;
        }


        // Modificar `aplicarZoom` para usar dimensiones originales globales
        function aplicarZoom(element, agrandar) {
            const dimensionesOriginales = obtenerDimensiones(element);
            if (!dimensionesOriginales) return; // Si no hay dimensiones, salir

            const tagName = element.tagName.toLowerCase();
            const zoomDelta = agrandar ? 10 : 0; // Solo aplica zoom si agrandar es true

            switch (tagName) {
                case 'ellipse': {
                    const nuevoRx = agrandar ? dimensionesOriginales.rx + zoomDelta : dimensionesOriginales.rx;
                    const nuevoRy = agrandar ? dimensionesOriginales.ry + zoomDelta : dimensionesOriginales.ry;
                    element.setAttribute('rx', nuevoRx);
                    element.setAttribute('ry', nuevoRy);
                    break;
                }
                case 'rect': {
                    const nuevoX = agrandar ? dimensionesOriginales.x - zoomDelta : dimensionesOriginales.x;
                    const nuevoY = agrandar ? dimensionesOriginales.y - zoomDelta : dimensionesOriginales.y;
                    const nuevoWidth = agrandar ? dimensionesOriginales.width + (2 * zoomDelta) : dimensionesOriginales.width;
                    const nuevoHeight = agrandar ? dimensionesOriginales.height + (2 * zoomDelta) : dimensionesOriginales.height;
                    element.setAttribute('x', nuevoX);
                    element.setAttribute('y', nuevoY);
                    element.setAttribute('width', nuevoWidth);
                    element.setAttribute('height', nuevoHeight);
                    break;
                }
                case 'polygon': {
                    const puntosOriginales = dimensionesOriginales.points.split(' ');
                    const nuevosPuntos = puntosOriginales.map((punto, index) => {
                        const [x, y] = punto.split(',').map(Number);

                        if (!agrandar) return `${x},${y}`; // Restaurar las coordenadas originales

                        if (element.classList.contains('poligono')) {
                            switch (index) {
                                case 0: return `${x - zoomDelta},${y - zoomDelta}`;
                                case 1: return `${x + zoomDelta},${y - zoomDelta}`;
                                case 2: return `${x + zoomDelta},${y + zoomDelta}`;
                                case 3: return `${x - zoomDelta},${y + zoomDelta}`;
                                default: return `${x},${y}`;
                            }
                        } else if (element.classList.contains('rombo')) {
                            switch (index) {
                                case 0: return `${x},${y - zoomDelta}`;
                                case 1: return `${x + zoomDelta},${y}`;
                                case 2: return `${x},${y + zoomDelta}`;
                                case 3: return `${x - zoomDelta},${y}`;
                                default: return `${x},${y}`;
                            }
                        }
                        return `${x},${y}`; // Por defecto, mantiene las coordenadas originales
                    });

                    element.setAttribute('points', nuevosPuntos.join(' '));
                    break;
                }
                default:
                    console.warn(`Tipo de elemento "${tagName}" no soportado para zoom.`);
            }
        }



    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>